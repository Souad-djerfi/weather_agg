import agregation
import app
import unittest

class TestAggregation(unittest.TestCase):

    def setUp(self):
         self.start= '1618486400'
         self.end= '1618572880'
         self.data= [
            {'value': 20, 'ts': '2021-04-15T12:00:00.000Z'},
            {'value': 21, 'ts': '2021-04-15T12:30:00.000Z'},
            {'value': 22, 'ts': '2021-04-15T13:00:00.000Z'},
            {'value': 27, 'ts': '2021-04-15T13:30:00.000Z'},
            {'value': 22, 'ts': '2021-04-15T14:00:00.000Z'},
            {'value': 21, 'ts': '2021-04-15T14:30:00.000Z'},
            {'value': 20, 'ts': '2021-04-15T15:00:00.000Z'},
            {'value': 25, 'ts': '2021-04-15T15:30:00.000Z'},
            {'value': 22, 'ts': '2021-04-15T14:00:00.000Z'},
            {'value': 23, 'ts': '2021-04-15T14:30:00.000Z'},
            {'value': 25, 'ts': '2021-04-15T15:00:00.000Z'},
            {'value': 22, 'ts': '2021-04-15T15:45:00.000Z'},
            {'value': 21, 'ts': '2021-04-15T16:00:00.000Z'},
            {'value': 22, 'ts': '2021-04-15T16:15:00.000Z'},
            {'value': 22, 'ts': '2021-04-15T17:00:00.000Z'},
            {'value': 21, 'ts': '2021-04-15T17:45:00.000Z'},
            {'value': 20, 'ts': '2021-04-15T18:00:00.000Z'},
            {'value': 20, 'ts': '2021-04-15T18:15:00.000Z'},
            {'value': 18, 'ts': '2021-04-15T19:00:00.000Z'},
            {'value': 17, 'ts': '2021-04-15T19:45:00.000Z'},
            {'value': 16, 'ts': '2021-04-15T20:00:00.000Z'},
            {'value': 16, 'ts': '2021-04-15T20:15:00.000Z'},
            {'value': 16, 'ts': '2021-04-15T21:00:00.000Z'},
            {'value': 15, 'ts': '2021-04-15T21:45:00.000Z'},
            {'value': 13, 'ts': '2021-04-15T22:00:00.000Z'},
            {'value': 13, 'ts': '2021-04-15T22:15:00.000Z'},
            {'value': 12, 'ts': '2021-04-15T23:00:00.000Z'},
            {'value': 12, 'ts': '2021-04-15T23:45:00.000Z'},
            {'value': 11, 'ts': '2021-04-16T01:00:00.000Z'},
            {'value': 10, 'ts': '2021-04-16T01:15:00.000Z'},
            {'value': 10, 'ts': '2021-04-16T02:00:00.000Z'},
            {'value': 10, 'ts': '2021-04-16T02:45:00.000Z'},
            {'value': 10, 'ts': '2021-04-16T03:00:00.000Z'},
            {'value': 11, 'ts': '2021-04-16T03:15:00.000Z'},
            {'value': 12, 'ts': '2021-04-16T04:00:00.000Z'},
            {'value': 12, 'ts': '2021-04-16T04:45:00.000Z'},
            {'value': 12, 'ts': '2021-04-16T05:00:00.000Z'},
            {'value': 13, 'ts': '2021-04-16T05:15:00.000Z'},
            {'value': 14, 'ts': '2021-04-16T06:00:00.000Z'},
            {'value': 14, 'ts': '2021-04-16T06:45:00.000Z'},
            {'value': 15, 'ts': '2021-04-16T07:00:00.000Z'},
            {'value': 15, 'ts': '2021-04-16T07:15:00.000Z'},
            {'value': 15, 'ts': '2021-04-16T08:00:00.000Z'},
            {'value': 16, 'ts': '2021-04-16T08:45:00.000Z'},
            {'value': 17, 'ts': '2021-04-16T09:00:00.000Z'},
            {'value': 17, 'ts': '2021-04-16T09:15:00.000Z'},
            {'value': 19, 'ts': '2021-04-16T10:00:00.000Z'},
            {'value': 20, 'ts': '2021-04-16T10:45:00.000Z'},
            {'value': 20, 'ts': '2021-04-16T11:00:00.000Z'},
            {'value': 20, 'ts': '2021-04-16T11:15:00.000Z'},
            {'value': 21, 'ts': '2021-04-16T12:00:00.000Z'},
            {'value': 21, 'ts': '2021-04-16T12:45:00.000Z'},
            {'value': 22, 'ts': '2021-04-16T13:00:00.000Z'},
            {'value': 23, 'ts': '2021-04-16T13:15:00.000Z'},
            {'value': 24, 'ts': '2021-04-16T14:00:00.000Z'},
            {'value': 24, 'ts': '2021-04-16T14:45:00.000Z'},
            
            ]

    def test_max_aggregation(self):
        
        expected_result = [{'value': 25, 'ts': '2021-04-15T13:33:20.000Z'},
                           {'value': 22, 'ts': '2021-04-15T15:33:20.000Z'}, 
                           {'value': 21, 'ts': '2021-04-15T17:33:20.000Z'}, 
                           {'value': 17, 'ts': '2021-04-15T19:33:20.000Z'},
                           {'value': 15, 'ts': '2021-04-15T21:33:20.000Z'}, 
                           {'value': 12, 'ts': '2021-04-15T23:33:20.000Z'}, 
                           {'value': 11, 'ts': '2021-04-16T01:33:20.000Z'}, 
                           {'value': 13, 'ts': '2021-04-16T03:33:20.000Z'}, 
                           {'value': 15, 'ts': '2021-04-16T05:33:20.000Z'}, 
                           {'value': 17, 'ts': '2021-04-16T07:33:20.000Z'}, 
                           {'value': 20, 'ts': '2021-04-16T09:33:20.000Z'}, 
                           {'value': 23, 'ts': '2021-04-16T11:33:20.000Z'}]
        
        result = agregation.agre('max', self.start, self.end, self.data)
        self.assertEqual(result, expected_result)

    def test_min_aggregation(self):
        
        expected_result = [
                           {'value': 20, 'ts': '2021-04-15T13:33:20.000Z'}, 
                           {'value': 21, 'ts': '2021-04-15T15:33:20.000Z'}, 
                           {'value': 18, 'ts': '2021-04-15T17:33:20.000Z'}, 
                           {'value': 16, 'ts': '2021-04-15T19:33:20.000Z'}, 
                           {'value': 12, 'ts': '2021-04-15T21:33:20.000Z'}, 
                           {'value': 10, 'ts': '2021-04-15T23:33:20.000Z'}, 
                           {'value': 10, 'ts': '2021-04-16T01:33:20.000Z'}, 
                           {'value': 12, 'ts': '2021-04-16T03:33:20.000Z'}, 
                           {'value': 14, 'ts': '2021-04-16T05:33:20.000Z'}, 
                           {'value': 15, 'ts': '2021-04-16T07:33:20.000Z'}, 
                           {'value': 19, 'ts': '2021-04-16T09:33:20.000Z'}, 
                           {'value': 21, 'ts': '2021-04-16T11:33:20.000Z'}
                           ]
        
        result = agregation.agre('min', self.start, self.end, self.data)
        self.assertEqual(result, expected_result)



def test_avg_aggregation(self):
    
    expected_result = [
                           {'value': 22.57, 'ts': '2021-04-15T13:33:20.000Z'}, 
                           {'value': 21.75, 'ts': '2021-04-15T15:33:20.000Z'}, 
                           {'value': 19.75, 'ts': '2021-04-15T17:33:20.000Z'}, 
                           {'value': 16.25, 'ts': '2021-04-15T19:33:20.000Z'}, 
                           {'value': 13.25, 'ts': '2021-04-15T21:33:20.000Z'}, 
                           {'value': 11, 'ts': '2021-04-15T23:33:20.000Z'}, 
                           {'value': 10.25, 'ts': '2021-04-16T01:33:20.000Z'}, 
                           {'value': 12.25, 'ts': '2021-04-16T03:33:20.000Z'}, 
                           {'value': 14.5, 'ts': '2021-04-16T05:33:20.000Z'}, 
                           {'value': 16.25, 'ts': '2021-04-16T07:33:20.000Z'}, 
                           {'value': 19.75, 'ts': '2021-04-16T09:33:20.000Z'}, 
                           {'value': 21.75, 'ts': '2021-04-16T11:33:20.000Z'}
                           ]
    
        
    result = agregation.agre('avg', self.start, self.end, self.data)
    self.assertEqual(result, expected_result)
    
        
